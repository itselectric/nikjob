---
- name: Downloading Weblate
  git: repo=git://github.com/nijel/weblate.git dest=/usr/local/weblate/

- name: Copying settings file
  template: src=settings.py dest=/usr/local/weblate/weblate/

- name: Starting Weblate
  shell: /bin/python /usr/local/weblate/manage.py migrate && /bin/python /usr/local/weblate/manage.py collectstatic --noinput && /bin/nohup /bin/python /usr/local/weblate/manage.py runserver 0:8000 > /var/log/weblate.log &

- name: Configuring Nginx
  copy: src=nginx.conf dest=/etc/nginx/nginx.conf

- name: Starting Nginx
  service: name=nginx state=started

- name: Autostart services
  shell: chkconfig {{ item }} on
  with_items:
    - mysql
    - nginx

- name: Autostart services
  lineinfile: dest=/etc/rc.d/rc.local line="/bin/nohup /bin/python /usr/local/weblate/manage.py runserver 0:8000 > /var/log/weblate.log &"
