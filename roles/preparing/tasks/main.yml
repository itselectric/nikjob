---
- name: Installing repos
  yum: name={{ item }} state=present
  with_items:
      - http://repo.percona.com/testing/centos/7/os/noarch/percona-testing-0.0-1.noarch.rpm
      - http://www.percona.com/downloads/percona-release/percona-release-0.0-1.x86_64.rpm
      - http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-5.noarch.rpm
#      - http://www.percona.com/downloads/percona-release/redhat/0.1-3/percona-release-0.1-3.noarch.rpm

- name: Enabling EPEL
  ini_file:  dest=/etc/yum.repos.d/epel.repo section=epel option=enabled value=1

- name: Installing tools
  yum: name={{ item }} state=present update_cache=yes
  with_items:
    - vim
    - mc
    - unzip
    - zip
    - telnet
    - net-tools
    - ntp
    - nano
    - sendmail
    - htop
    - nmap
    - wget
    - nginx
    - gcc
    - python-pip
    - git
    - mercurial
    - MySQL-python

- name: Installing python tools
  pip: name={{ item }}
  with_items:
    - python-devel
    - translate-toolkit
    - python-whoosh
    - python-pillow
    - python-pylibravatar
    - python-babel
    - python-lxml
    - python-social-auth
    - Django
    - django-crispy-forms
    - pyuca
    - https://pypi.python.org/packages/2.7/d/django_compressor/django_compressor-2.0-py2.py3-none-any.whl
    - python-dateutil
    - python-virtualenv
    - six
    - uwsgi
#    - weblate
#    - gunicorn

- name: Install Percona
  yum: name={{ item }} state=present
  with_items:
      - Percona-XtraDB-Cluster-55

- name: Initialization base databases
  shell: /usr/bin/mysql_install_db

- name: Allowing port in firewall
  firewalld: service=http permanent=true state=enabled immediate=yes
  ignore_errors: true

- name: Allowing localhost in firewall
  shell: firewall-cmd --permanent --zone=trusted --add-interface=lo

- name: Restarting firewall
  service: name=firewalld state=reloaded
